<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Yingjie Liu" />






<meta name="description" content="Student/THU/GSoC'17">
<meta property="og:type" content="website">
<meta property="og:title" content="Yingjie Liu's Blog">
<meta property="og:url" content="https://yjwudi.github.io/index.html">
<meta property="og:site_name" content="Yingjie Liu's Blog">
<meta property="og:description" content="Student/THU/GSoC'17">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yingjie Liu's Blog">
<meta name="twitter:description" content="Student/THU/GSoC'17">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Yingjie Liu&#39;s Blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/avatar.jpg">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Yingjie Liu&#39;s Blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>



    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-56ff76c972fc0cf9"></script>



    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?be11afd3596504a0dc0ea401f7154654";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Yingjie Liu</a></h1>
        </hgroup>


        <p class="header-subtitle">Student/THU/GSoC'17</p>



            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="true" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>




            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>

                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>


                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>

                    </div>

                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>Menu</li>
                    <!--
                        <li>Tags</li>
                        <li>Friends</li>
                    -->
                        <li>About Me</li>

                    </ul>
                </div>
            </div>


        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>

                            <li><a href="/">Articles</a></li>
                        <!--
                            <li><a href="/tags/">标签</a></li>

                            <li><a href="/tags/推荐/">推荐</a></li>

                            <li><a href="/tags/随笔/">随笔</a></li>
                        -->

                            <li><a href="/tags/MummyDing">About Me</a></li>

                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">

                                <a class="fa Email" href="mailto:yingjiewudi@gmail.com" title="Email"></a>

                                <a class="fa GitHub" href="https://github.com/yjwudi" title="GitHub"></a>

                        </ul>
                    </nav>
                </section>

                <section class="switch-part switch-part4">

                    <div id="js-aboutme">Student/THU/GSoC'17</div>
                </section>

            </div>
        </div>
    </header>
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="back to homepage">Yingjie Liu</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="back to homepage">Yingjie Liu</a></h1>
            </hgroup>

            <p class="header-subtitle">Student/THU/GSoC'17</p>

            <nav class="header-menu">
                <ul>

                    <li><a href="/">Articles</a></li>
                        <!--
                            <li><a href="/tags/">标签</a></li>

                            <li><a href="/tags/推荐/">推荐</a></li>

                            <li><a href="/tags/随笔/">随笔</a></li>
                        -->

                            <li><a href="/tags/MummyDing">About Me</a></li>

                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">

                                <a class="fa Email" href="mailto:yingjiewudi@gmail.com" title="Email"></a>

                                <a class="fa GitHub" href="https://github.com/yjwudi" title="GitHub"></a>

                        </ul>
            </nav>
        </header>
    </div>
    <link class="menu-list" tags="Tags" friends="Friends" about="About Me"/>
</nav>



<div class="body-wrap">
<article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">

    <div class="article-meta">
        <a href="/2017/07/03/dlib/" class="article-date">
        <time datetime="2017-07-03T07:32:00.000Z" itemprop="datePublished">2017-07-03</time>
        </a>


    </div>

  <div class="article-inner">

      <input type="hidden" class="isFancy" />


      <header class="article-header">


    <h1 class="article-title" itemprop="name">
      July 1-July 30 (1): Progress of Importing Code From Dlib
    </h1>

      </header>

      <div class="article-info article-info-post">
        <div class="clearfix"></div>
      </div>


    <div class="article-entry" itemprop="articleBody">
        I have been keeping on importing deep learning code from dlib, the details can be seen here: <a href="https://github.com/yjwudi/digiKam-Test/tree/master/qt_dlib_dnn" target="_blank" rel="external">https://github.com/yjwudi/digiKam-Test/tree/master/qt_dlib_dnn</a>.
There left two problems in last report email: reading model file and how to input data.<br>
        <strong>
            Reading model file
        </strong>
        <br>
        The model file is read by deserialize function in <a href="https://github.com/yjwudi/digiKam-Test/blob/master/qt_dlib_dnn/dnn/serialize.h" target="_blank" rel="external">https://github.com/yjwudi/digiKam-Test/blob/master/qt_dlib_dnn/dnn/serialize.h</a>. The deserialize is written by using template function in C++, so it can be suitable for different type of data. But I met with a problem when I using deserialize function in dlib. If we want to deserialize a class A, It is written like this in dlib:<br>
Class A<br>
{<br>
public:<br>
     ....//other functions<br>
    friend void deserialize(A& a, std::istream in)<br>
    {<br>
        std::string version;<br>
        <font color="#FF0000">deserialize(version, in);</font><br>
        deserialize(a.m_int, in);<br>
        deserialize(a.m_float, in);<br>
    }<br>
 <br>
private:<br>
    int m_int;<br>
    double m_float;<br>
}<br>
The compiler will report an error with the red line. Such error means if you create a new variable in the friend function, the template function deserialize can't set value into the variable, but it the template function deserialize can set value to a member of class A. I did not find the reason of such error. So I rewrite a new function instead of using the template function deserialize. The code looks like:<br>
Class A<br>
{<br>
public:<br>
     ....//other functions<br>
    friend void deserialize(A& a, std::istream in)<br>
    {<br>
        std::string version;<br>
        deserialize_str(version, in); //a special function for st::string type<br>
        deserialize(a.m_int, in); //template function<br>
        deserialize(a.m_float, in); //template function<br>
    }<br>
 <br>
private:<br>
    int m_int;<br>
    double m_float;<br>
}<br>
Such code can be found in <a href="https://github.com/yjwudi/digiKam-Test/blob/master/qt_dlib_dnn/dnn/nn/core.h" target="_blank" rel="external">https://github.com/yjwudi/digiKam-Test/blob/master/qt_dlib_dnn/dnn/nn/core.h</a> (deserialize_str, deserialize_int, deserialize_bool...).
Anyway, the reading model file part is ok.<br>
<strong>
    How to input data
</strong>
<br>
The tringing image is read by OpenCV and changed into dlib::Matrix. This is down by adding this part: <a href="https://github.com/yjwudi/digiKam-Test/tree/master/qt_dlib_dnn/dnn/image_transforms" target="_blank" rel="external">https://github.com/yjwudi/digiKam-Test/tree/master/qt_dlib_dnn/dnn/image_transforms</a><br>

Now I am working on the "forward propagation" part of the network. The code did not work like what I hoped: Input an image->Compute the 128d vector->Compare the distance of vectors. There are some problems with "Compute the 128d vector" part. In one layer, the forward computing meets an error with another template function for matrix multiplying. Here are the details:<br>
Matrix A can be multiplied by another matrix B, and it can also be multiplied by a single number(float or int). In dlib, it use two template function for multiply situations:<br>
(1)<br>
    template < typename EXP1, typename EXP2 ><br>
    inline const typename return_type operator* (<br>
        const matrix_exp<EXP1>& m1,<br>
        const matrix_mul_scal_exp<EXP2>& m2<br>
    )<br>
    {<br>
        typedef matrix_multiply_exp<EXP1, EXP2> exp1;<br>
        typedef matrix_mul_scal_exp<exp1,false> exp2;<br>
        return exp2(exp1(m1.m, m2.ref()), m1.s);<br>
    }<br>
explanation: this is appearently for matrix*matrix. return_type represents a complicate type, this doesn't matter. matrix_multiply_exp and matrix_mul_scal_exp are two matrix class inherited from Matrix. EXP1 and EXP2 means different type of matrix. This code can be seen in <a href="https://github.com/yjwudi/digiKam-Test/blob/master/qt_dlib_dnn/dnn/matrix/matrix.h#L265" target="_blank" rel="external">https://github.com/yjwudi/digiKam-Test/blob/master/qt_dlib_dnn/dnn/matrix/matrix.h#L265</a><br>
(2)<br>
     template <<br>
        typename EXP,<br>
        typename S <br>
        ><br>
    inline typename return_type operator* (<br>
        const matrix_exp<EXP>& m,<br>
        const S& s<br>
    )<br>
    {<br>
        typedef typename EXP::type type;<br>
        return matrix_mul_scal_exp<EXP>(m.ref(),static_cast<type>(s));<br>
    }<br>
explanation: this is appearently for matrix*single number. This code can be seen in <a href="https://github.com/yjwudi/digiKam-Test/blob/master/qt_dlib_dnn/dnn/matrix/matrix.h#L690" target="_blank" rel="external">https://github.com/yjwudi/digiKam-Test/blob/master/qt_dlib_dnn/dnn/matrix/matrix.h#L690</a><br>
The error is: when I want to multiply two matrix A and B, I write the code: A*B; The compiler says ambiguous overload of *. Because it thinks the matrix in B can also be taken as a type S in template function (2). So the compiler thinks the two functions both can be performed when we want A*B.
I didn't find solutions for solvint this error, so I commented the second template function. And some error happened when the network is computing.
<br>
I will try to solve the problem next week.




         <br>
         <br>
         <br>

</div>




 <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i>
                2017 Yingjie Liu
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="A fast, simple &amp; powerful blog framework">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="Another simple and elegant theme for Hexo  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>

            <div class="visit">

                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="Site Visitors"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>


                    <span>| </span>


                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="Page Hits"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>

            </div>

    </div>
</footer>
    </div>

    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 2;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="Back to Top"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="Comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="Go to Bottom"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window

        var oOpenInNew = {
             github: ".github-widget a",





             archives: ".archive-article-title",
             miniArchives: "a.post-list-link",

             friends: "#js-friends a",
             socail: ".social a"
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }

</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "Yingjie Liu's Blog";
                clearTimeout(titleTime);
            }
            else {
                document.title = "Yingjie Liu's Blog";
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>
